load("C:/Users/kc19o338/Desktop/Real world predictions project/3stagemodel_final.RData")
############### LIBRARIES #################################
### Load needed variables
library(readxl)
library(dplyr)
library(rms)
library(lme4)
library(R2jags)
library(vcd)
library(glmnet)
library(xlsx)
library(ggpubr)
library(gridExtra)
library(devtools)
library(pROC)
library(plyr)
library(tidyverse)
View(MISMSCdata)
View(MISMSCdata)
table(SMSCdata$outcome)
302+1450
302/1450
x<-SMSCdata %>%group_by(patient.id) %>%slice(which.max(unique.visit.id))
x<-unique(SMSCdata$patient.id)
x
### Load needed variables
library(readxl)
library(dplyr)
library(rms)
#load the data
observational_cycles_all=read_excel("C:/Users/kc19o338/Desktop/SMSC Basel/SMSC_phase1_cycles.xlsx")
observational_cycles_all=SMSCdata
## keep needed variables
tokeep<-c("unique.visit.id" , "patient.id", "age", "gender","edss", "disease.duration","treatment.naive.prior.visit", "months.since.last.relapse", "nr.relapses.2y.prior.study",
"nr.Gd.enhanced.lesions","treatment.during.cycle","treatment.time.during.cycle.months","relapse.2y.after.study")
observational_cycles <- observational_cycles_all[,(names(observational_cycles_all) %in% tokeep)]
#number of rows
nrow(observational_cycles) #1752
#number of unique patients
length(unique(observational_cycles$patient.id)) #935
# number of complete cases
nrow(na.omit(observational_cycles)) #459
#variables included in the final dataset
names(observational_cycles)
#number of patients with 1, 2, or 3 two-years cycles
n_occur <- data.frame(table(observational_cycles$patient.id))
##dataset with the first visit for each unique patient
observational_cycles_unique<-observational_cycles[!duplicated(observational_cycles$patient.id),]
nrow(observational_cycles_unique)
#unique
counts <- table(observational_cycles_unique$relapse.2y.after.study, useNA = "ifany")
names(counts)[is.na(names(counts))] <- "NA"
barplot(counts, main="Relapse during the next 2 years Distribution (unique)",
xlab="Relapse during the next 2 years", col = "blue", space=2)
#unique
counts <- table(observational_cycles_unique$relapse.2y.after.study, useNA = "ifany")
#unique
counts <- table(observational_cycles_unique$outcome, useNA = "ifany")
## keep needed variables
tokeep<-c("unique.visit.id" , "patient.id", "age", "gender","edss", "disease.duration","treatment.naive.prior.visit", "months.since.last.relapse", "nr.relapses.2y.prior.study",
"nr.Gd.enhanced.lesions","treatment.during.cycle","treatment.time.during.cycle.months","outcome")
observational_cycles <- observational_cycles_all[,(names(observational_cycles_all) %in% tokeep)]
##dataset with the first visit for each unique patient
observational_cycles_unique<-observational_cycles[!duplicated(observational_cycles$patient.id),]
nrow(observational_cycles_unique)
#unique
counts <- table(observational_cycles_unique$outcome, useNA = "ifany")
names(counts)[is.na(names(counts))] <- "NA"
barplot(counts, main="Relapse during the next 2 years Distribution (unique)",
xlab="Relapse during the next 2 years", col = "blue", space=2)
table(observational_cycles_unique$relapse.2y.after.study,useNA = "ifany")
table(observational_cycles_unique$outcome,useNA = "ifany")
191+744
191/935
15/25
14/25
nrow(RiskData)
nrow(MSrelapse)
nrow(RCTs)
table(RCTs$STUDYID)
load("C:/Users/kc19o338/Desktop/Real world predictions project/TwoStageRCTsResults.RData")
nrow(MSrelapse)
table(MSrelapse$STUDYID)
summary(MSrelapse$AGE[MSrelapse$STUDYID=="DEFINE"])
summary(MSrelapse$AGE[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Dimethyl Fumarate"])
table(MSrelapse$TRT01A)
summary(MSrelapse$AGE[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Dimethyl fumarate"])
sd(MSrelapse$AGE[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Dimethyl fumarate"])
summary(MSrelapse$AGE[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="placebo"])
summary(MSrelapse$AGE[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Placebo"])
sd(MSrelapse$AGE[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Placebo"])
table(MSrelapse$SEX[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Placebo"])
102+306
102/408
table(MSrelapse$SEX[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Dimethyl fumarate"])
224+602
224/826
summary(MSrelapse$EDSSBL[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Placebo"])
sd(MSrelapse$EDSSBL[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Placebo"])
summary(MSrelapse$EDSSBL[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Dimethyl fumarate"])
sd(MSrelapse$EDSSBL[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Dimethyl fumarate"])
sd(MSrelapse$EDSSBL[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Dimethyl fumarate"], na.rm=F)
sd(MSrelapse$EDSSBL[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Dimethyl fumarate"], na.rm=T)
summary(MSrelapse$TRELMOS[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Dimethyl fumarate"])
summary(MSrelapse$RLPS1YR[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Dimethyl fumarate"])
summary(MSrelapse$AGE[MSrelapse$STUDYID=="AFFIRM" & MSrelapse$TRT01A=="Placebo"])
sd(MSrelapse$AGE[MSrelapse$STUDYID=="AFFIRM" & MSrelapse$TRT01A=="Placebo"])
sd(MSrelapse$AGE[MSrelapse$STUDYID=="AFFIRM" & MSrelapse$TRT01A=="Natalizumab"])
summary(MSrelapse$AGE[MSrelapse$STUDYID=="AFFIRM" & MSrelapse$TRT01A=="Natalizumab"])
table(MSrelapse$SEX[MSrelapse$STUDYID=="AFFIRM" & MSrelapse$TRT01A=="Natalizumab"])
178+449
178/627
1-0.2838915
table(MSrelapse$SEX[MSrelapse$STUDYID=="AFFIRM" & MSrelapse$TRT01A=="placebo"])
table(MSrelapse$SEX[MSrelapse$STUDYID=="AFFIRM" & MSrelapse$TRT01A=="Placebo"])
208+104
208/312
table(MSrelapse$SEX[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Placebo"])
table(MSrelapse$SEX[MSrelapse$STUDYID=="DEFINE" & MSrelapse$TRT01A=="Dimethyl fumarate"])
summary(MSrelapse$EDSSBL[MSrelapse$STUDYID=="AFFIRM" & MSrelapse$TRT01A=="Natalizumab"])
sd(MSrelapse$EDSSBL[MSrelapse$STUDYID=="AFFIRM" & MSrelapse$TRT01A=="Natalizumab"])
sd(MSrelapse$EDSSBL[MSrelapse$STUDYID=="AFFIRM" & MSrelapse$TRT01A=="placebo"])
sd(MSrelapse$EDSSBL[MSrelapse$STUDYID=="AFFIRM" & MSrelapse$TRT01A=="Placebo"])
summary(MSrelapse$EDSSBL[MSrelapse$STUDYID=="AFFIRM" & MSrelapse$TRT01A=="Placebo"])
summary(MSrelapse$EDSSBL[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Placebo"])
sd(MSrelapse$EDSSBL[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Placebo"])
sd(MSrelapse$EDSSBL[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="DImethyl fumarate"])
summary(MSrelapse$EDSSBL[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="DImethyl fumarate"])
summary(MSrelapse$EDSSBL[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Dimethyl fumarate"])
sd(MSrelapse$EDSSBL[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Dimethyl fumarate"])
summary(MSrelapse$EDSSBL[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Glatiramer acetate"])
sd(MSrelapse$EDSSBL[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Glatiramer acetate"])
summary(MSrelapse$AGE[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Dimethyl fumarate"])
sd(MSrelapse$AGE[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Dimethyl fumarate"])
summary(MSrelapse$AGE[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Glatiramer acetate"])
sd(MSrelapse$AGE[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Glatiramer acetate"])
summary(MSrelapse$AGE[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Placebo"])
sd(MSrelapse$AGE[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Placebo"])
table(MSrelapse$SEX[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Dimethyl fumarate"])
495+208
495/703
table(MSrelapse$SEX[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Glatiramer acetate"])
247+104
247/351
table(MSrelapse$SEX[MSrelapse$STUDYID=="CONFIRM" & MSrelapse$TRT01A=="Placebo"])
251+112
251/363
19/25
11/25
97/126
89/125
#### Table 4
###absolute benefits
#all these tables have been created in the GraphForPredictedRisk.R script
LASSOtable
load("C:/Users/kc19o338/Desktop/Real world predictions project/3stagemodel_final.RData")
IPDADNMRJAGSresultsSMSC$BUGSoutput$mean$logitp
IPDADNMRJAGSresultsSMSC
load("C:/Users/kc19o338/Desktop/Real world predictions project/3stagemodel_final.RData")
IPDADNMRJAGSresultsSMSC
##########################################################
############### LIBRARIES #################################
### Load needed variables
library(readxl)
library(dplyr)
library(rms)
library(lme4)
library(R2jags)
library(vcd)
library(glmnet)
library(xlsx)
library(ggpubr)
library(gridExtra)
library(devtools)
library(pROC)
library(plyr)
library(tidyverse)
#run the model
set.seed(2000)
IPDADNMRJAGSresultsSMSC <- jags.parallel(data = jagsdataIPDADNMR,inits=NULL,parameters.to.save = c('gamma.w','gamma.b', 'meanRisk','logitpplacebo','lognr.Gd.enhanced.lesionsAD','gamma', 'ORref','delta','u','loggenderAD', 'meanRisk','months.since.last.relapseAD','ageAD', 'edssAD', 'disease.durationAD', 'logtreatment.naive.prior.visitAD', 'logitp'),model.file = modelIPDADNMR,
n.chains=2,n.iter = 10000,n.burnin = 1000,DIC=F,n.thin = 10)
#data for jags model
source("DataforIPDADNMR.R")
#model IPD & AD NMR with imputation for missing study-level covariates
source("R/modelIPDADNMR_imputation.R") #source the model will be used for rjags
#run the model
set.seed(2000)
IPDADNMRJAGSresultsSMSC <- jags.parallel(data = jagsdataIPDADNMR,inits=NULL,parameters.to.save = c('gamma.w','gamma.b', 'meanRisk','logitpplacebo','lognr.Gd.enhanced.lesionsAD','gamma', 'ORref','delta','u','loggenderAD', 'meanRisk','months.since.last.relapseAD','ageAD', 'edssAD', 'disease.durationAD', 'logtreatment.naive.prior.visitAD', 'logitp'),model.file = modelIPDADNMR,
n.chains=2,n.iter = 10000,n.burnin = 1000,DIC=F,n.thin = 10)
